## 滤波器公式的离散化

### 1. 你的公式：`u_filtered(t) = u_filtered(t−dt) + (u_input − u_filtered(t−dt)) * (1 − exp(−dt/tc))`

这个公式是**一阶低通滤波器的精确离散化形式**，假设输入 `u_input` 在时间步长 `dt` 内是**常数**（即零阶保持，Zero-Order Hold）。

它来源于连续时间一阶系统的解：
$$\tau \frac{dy}{dt} + y = u$$
如果 $u$ 在 $[t-dt, t]$ 之间为常数 $u_{input}$，那么输出的解为：
$$y(t) = y(t-dt) e^{-dt/\tau} + u_{input} (1 - e^{-dt/\tau})$$
将 $y(t-dt)$ 项移到等式右侧，并提取公因式，就得到了你的公式：
$$y(t) = y(t-dt) + (u_{input} - y(t-dt)) (1 - e^{-dt/\tau})$$
所以，你提供的公式是**精确的离散解**，在输入是阶跃信号（或在每个 `dt` 内保持不变）的情况下。

### 2. 我的代码中的公式：`self.output = self.output + alpha * (self.input - self.output)`，其中 `alpha = dt / (self.time_constant + dt)`

我的代码中的公式是**一阶低通滤波器的一种常见近似离散化形式**，它被称为：

*   **后向欧拉法 (Backward Euler)** 的一种变体，或者
*   **"匹配极点" (Matched Pole)** 离散化，或者
*   **指数平滑 (Exponential Smoothing)** 的通用形式。

它是通过对连续时间微分方程进行近似得到的。

### 3. 两种离散化方法的比较

*   **你的公式 (`1 - exp(-dt/tc)`)：**
    *   **优点:** 对于阶跃输入，它是**精确的离散解**。它能更准确地捕捉到系统在时间步长内的响应，尤其是在 `dt` 相对 `tc` 较大时。
    *   **缺点:** 计算中包含指数函数 `exp()`，计算量相对稍大。

*   **我的代码中的公式 (`dt / (tc + dt)`)：**
    *   **优点:** 计算**非常简单和高效**，只涉及加减乘除。在许多实时嵌入式系统和仿真中广泛使用。
    *   **缺点:** 它是**近似解**。当 `dt` 远小于 `tc` (`dt << tc`) 时，这个近似非常接近精确解。
        *   当 $x = dt/\tau$ 很小时，泰勒展开 $e^{-x} \approx 1 - x$。
        *   所以，$1 - e^{-dt/\tau} \approx 1 - (1 - dt/\tau) = dt/\tau$ (这是前向欧拉法的近似)。
        *   而 $\frac{dt}{\tau+dt} = \frac{dt/\tau}{1+dt/\tau}$。当 $dt/\tau$ 很小时，$\frac{1}{1+dt/\tau} \approx 1 - dt/\tau$，所以 $\frac{dt}{\tau+dt} \approx dt/\tau (1 - dt/\tau) = dt/\tau - (dt/\tau)^2$。
        *   虽然两者都是近似（当 $dt \ll \tau$），但 $\frac{dt}{\tau+dt}$ 在实际应用中通常表现良好，并且具有更好的数值稳定性特性。

**总结：**

你的公式是**阶跃输入下的精确离散解**。我的代码使用的是一种**近似离散化方法**（后向欧拉法或匹配极点离散化），它在计算上更简单，并且在仿真步长远小于滤波器时间常数时，能提供足够好的精度。

---

## 概念解释

### 1. 连续时间一阶滤波器 (Continuous-Time First-Order Filter)

连续时间一阶滤波器是最简单的动态系统之一，通常用于对信号进行平滑处理，去除高频噪声，或者模拟传感器、执行器、电机等系统的动态响应。

它的标准微分方程形式为：
$$\tau \frac{dy(t)}{dt} + y(t) = u(t)$$
其中：
*   $u(t)$ 是输入信号。
*   $y(t)$ 是输出信号。
*   $\tau$ (tau) 是**时间常数 (Time Constant)**。它决定了滤波器的响应速度。
    *   $\tau$ 越大，滤波器响应越慢，输出越平滑，截止频率越低。
    *   $\tau$ 越小，滤波器响应越快，输出越接近输入，截止频率越高。
    *   当输入是阶跃信号时，输出从初始值变化到最终值的 $63.2\%$ 所需的时间就是 $\tau$。

在拉普拉斯变换域，其传递函数为：
$$H(s) = \frac{Y(s)}{U(s)} = \frac{1}{\tau s + 1}$$
这是一个低通滤波器，其截止频率（-3dB 频率）为 $f_c = \frac{1}{2\pi\tau}$ 赫兹或 $\omega_c = \frac{1}{\tau}$ 弧度/秒。

### 2. 后向欧拉法 (Backward Euler Method)

后向欧拉法是一种用于数值求解常微分方程 (Ordinary Differential Equations, ODEs) 的**隐式**离散化方法。

对于一个通用的一阶常微分方程：
$$\frac{dx}{dt} = f(x, t)$$
后向欧拉法的离散化公式为：
$$\frac{x_{k+1} - x_k}{\Delta t} = f(x_{k+1}, t_{k+1})$$
其中：
*   $x_k$ 是在时间 $t_k$ 时的状态值。
*   $x_{k+1}$ 是在时间 $t_{k+1} = t_k + \Delta t$ 时的状态值。
*   $\Delta t$ 是时间步长。
*   **关键点：** 等式右侧的函数 $f$ 是用**下一个时间步的状态 $x_{k+1}$** 来计算的。这就是它被称为“隐式”方法的原因，因为 $x_{k+1}$ 可能出现在等式两边，通常需要迭代或求解方程组来得到 $x_{k+1}$。

**在连续时间一阶滤波器中的应用：**

对于一阶滤波器微分方程 $\frac{dy}{dt} = \frac{1}{\tau}(u - y)$，应用后向欧拉法：
$$\frac{y_{k+1} - y_k}{\Delta t} = \frac{1}{\tau}(u_{k+1} - y_{k+1})$$
如果我们假设输入 $u_{k+1} \approx u_k$（即在当前时间步内输入保持不变），并整理方程：
$$y_{k+1}\tau - y_k\tau = \Delta t u_k - \Delta t y_{k+1}$$
$$y_{k+1}(\tau + \Delta t) = y_k\tau + \Delta t u_k$$
$$y_{k+1} = \frac{\tau}{\tau + \Delta t} y_k + \frac{\Delta t}{\tau + \Delta t} u_k$$
这个公式可以进一步改写为：
$$y_{k+1} = y_k + \left( \frac{\Delta t}{\tau + \Delta t} \right) (u_k - y_k)$$
这里的 $\alpha = \frac{\Delta t}{\tau + \Delta t}$，与我的代码中的实现完全一致。

**优点：** 相比于前向欧拉法（显式方法），后向欧拉法通常具有更好的**数值稳定性**，尤其是在处理“硬性问题”（stiff problems）时（即时间常数非常小的系统）。这意味着可以使用更大的时间步长而不会导致数值发散。

**缺点：** 它是隐式的，在更复杂的系统中可能需要求解方程组，计算成本更高。但在像一阶滤波器这样简单的系统中，可以直接解出 $y_{k+1}$。

---